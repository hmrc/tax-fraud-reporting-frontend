@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import viewmodels.govuk.AutocompleteOption
@import viewmodels.InputWidth._
@import models.backend.Address
@import views.html.components.Autocomplete
@import play.api.Configuration

@this(
	layout: templates.Layout,
	formHelper: FormWithCSRF,
	fieldset: GovukFieldset,
	govukErrorSummary: GovukErrorSummary,
	govukInput: GovukInput,
	govukButton: GovukButton,
	autocomplete: Autocomplete,
	configuration: Configuration
)

@(form: Form[Address], index: Index, mode: Mode, forBusiness: Boolean)(implicit request: Request[_], messages: Messages)

@journeyParams = @{
	if( forBusiness ) ("business", routes.BusinessAddressController.onSubmit(index, mode) )
	else              ("individual", routes.IndividualAddressController.onSubmit(index, mode) )
}

@msgHeading = @{ messages( journeyParams._1 + "Address.heading" ) }
@submissionRoute = @{ journeyParams._2 }

@contentHeader = {
	@if( !forBusiness ){
		<span class="govuk-visually-hidden">@messages("individual.caption.text.screen.reader")</span>
		<span class="govuk-caption-xl">@messages(s"individual.${index.display}")</span>
	}
	<h1 class="govuk-fieldset__legend--xl govuk-!-margin-top-0">@msgHeading</h1>
}

@fields = @{ Seq(
	"line1",
	"line2",
	"line3",
	"townOrCity",
	"postCode"
)}

@countries = @{ configuration.get[Seq[String]]("countries") }

@content = {
	@for( field <- fields ){
		@govukInput(
			InputViewModel(
				field = form(field),
				label = LabelViewModel(messages("address." + field))
			).withWidth(Full)
		)
	}

	@autocomplete(
		field = form("country"),
		id = "country",
		name = "country",
		isPageHint = false,
		hint = None,
		isPageHeading = false,
		label = "address.country",
		options = countries map AutocompleteOption.get(messages, "country")
	)
}

@layout(pageTitle = title(form, msgHeading)) {
	@formHelper(action = submissionRoute, 'autoComplete -> "off") {

		@if(form.errors.nonEmpty) {
			@govukErrorSummary(ErrorSummaryViewModel(form))
		}

		@fieldset(
			Fieldset(
				legend = Some(Legend(
					content = HtmlContent(contentHeader)
				)),
				describedBy = Some("hint-text"),
				role = Some("group"),
				html = content
			)
		)

		@govukButton(
			ButtonViewModel(messages("site.continue"))
				.withAttribute("id" -> "continue-button")
		)
	}
}
